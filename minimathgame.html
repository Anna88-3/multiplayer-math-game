<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¹ä¹ä¹˜æ³•å¤§æŒ‘æˆ° - å°å­©ç‰ˆ</title>
    <style>
        /* 1. æ‰‹æ©Ÿç‰ˆåŸºç¤è¨­å®šèˆ‡å¤§å­—é«” */
        body { font-family: 'Microsoft JhengHei', sans-serif; text-align: center; background-color: #FFF9E6; margin: 0; padding: 10px; overflow-x: hidden; }
        .game-container { background: white; width: 95%; max-width: 500px; margin: 10px auto; padding: 20px; border-radius: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); border: 8px solid #FFD966; box-sizing: border-box; }
        
        h2 { color: #E67E22; font-size: 32px; margin-bottom: 10px; }
        .stats { display: flex; justify-content: space-around; font-size: 24px; font-weight: bold; color: #34495E; margin-bottom: 15px; }
        
        /* 2. é¡Œç›®åŠ ç²—æ”¾å¤§ */
        #question { font-size: 80px; font-weight: 900; margin: 20px 0; color: #2C3E50; text-shadow: 2px 2px #FFD966; }
        #answer-input { font-size: 40px; font-weight: bold; width: 80%; padding: 15px; text-align: center; border: 4px solid #BDC3C7; border-radius: 15px; background: #ECF0F1; margin-bottom: 20px; }

        /* 3. è™›æ“¬å¤§æ•¸å­—éµç›¤ */
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 10px auto; max-width: 300px; }
        .key { background: #5DADE2; color: white; font-size: 32px; font-weight: bold; padding: 20px; border-radius: 15px; border: none; box-shadow: 0 5px #2E86C1; cursor: pointer; transition: 0.1s; }
        .key:active { box-shadow: 0 2px #2E86C1; transform: translateY(3px); }
        .key.back { background: #E74C3C; box-shadow: 0 5px #C0392B; }
        .key.zero { grid-column: span 2; }

        #start-btn { background: #27AE60; color: white; border: none; padding: 20px 40px; font-size: 28px; font-weight: bold; cursor: pointer; border-radius: 50px; margin-top: 10px; box-shadow: 0 6px #1E8449; }

        /* 4. çµç®—ç•«é¢ (å¯æ„›ç†Š) */
        #finish-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
        .bear-img { width: 200px; height: auto; margin-bottom: 20px; }
        .congrats-text { font-size: 40px; font-weight: 900; color: #E67E22; margin: 10px; }
        #final-score { font-size: 60px; color: #C0392B; }

        /* æ’è¡Œæ¦œ */
        #leaderboard { margin-top: 30px; font-size: 18px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border-bottom: 2px solid #FFD966; padding: 12px; font-weight: bold; }
    </style>
</head>
<body>

<div class="game-container">
    <h2>ğŸ» ä¹ä¹ä¹˜æ³•å¤§ç‹</h2>
    <div class="stats">
        <div>å¾—åˆ†: <span id="score">0</span></div>
        <div>æ™‚é–“: <span id="timer">30</span>s</div>
    </div>
    
    <div id="game-box">
        <div id="question">æº–å‚™é–‹å§‹å›‰</div>
        <input type="number" id="answer-input" readonly placeholder="é»æŒ‰éµå¡«ç­”æ¡ˆ">
        
        <div class="keypad">
            <button class="key" onclick="pressKey('1')">1</button>
            <button class="key" onclick="pressKey('2')">2</button>
            <button class="key" onclick="pressKey('3')">3</button>
            <button class="key" onclick="pressKey('4')">4</button>
            <button class="key" onclick="pressKey('5')">5</button>
            <button class="key" onclick="pressKey('6')">6</button>
            <button class="key" onclick="pressKey('7')">7</button>
            <button class="key" onclick="pressKey('8')">8</button>
            <button class="key" onclick="pressKey('9')">9</button>
            <button class="key zero" onclick="pressKey('0')">0</button>
            <button class="key back" onclick="pressKey('back')">â† åˆªé™¤</button>
        </div>
        
        <button id="start-btn" onclick="startGame()">é–‹å§‹æ¯”è³½!</button>
    </div>

    <div id="leaderboard">
        <h3>ğŸ† é«˜æ‰‹æ¦œ</h3>
        <table>
            <thead><tr><th>åæ¬¡</th><th>åå­—</th><th>åˆ†æ•¸</th></tr></thead>
            <tbody id="rank-body"></tbody>
        </table>
    </div>
</div>

<div id="finish-overlay">
    <img src="https://img.icons8.com/color/480/teddy-bear.png" class="bear-img" alt="Cute Bear">
    <div class="congrats-text">å¥½æ£’å–”ï¼</div>
    <div class="congrats-text">æ­å–œä½ å¾—äº† <span id="final-score">0</span> åˆ†ï¼</div>
    <button id="restart-btn" onclick="closeOverlay()" style="font-size:24px; padding:15px 30px; border-radius:20px; background:#5DADE2; color:white; border:none; margin-top:20px;">å†ç©ä¸€æ¬¡</button>
</div>

<audio id="correct-sound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // --- è«‹å¡«å…¥ä½ çš„ Firebase Config ---
    const firebaseConfig = {
        apiKey: "ä½ çš„APIKEY",
        authDomain: "ä½ çš„PROJECT.firebaseapp.com",
        databaseURL: "ä½ çš„DATABASE_URL",
        projectId: "ä½ çš„PROJECT_ID",
        storageBucket: "...",
        messagingSenderId: "...",
        appId: "..."
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const scoreRef = ref(db, 'scores');

    let score = 0;
    let timeLeft = 30;
    let currentAns = 0;
    let timerInterval;

    const questionEl = document.getElementById('question');
    const inputEl = document.getElementById('answer-input');
    const scoreEl = document.getElementById('score');
    const timerEl = document.getElementById('timer');
    const startBtn = document.getElementById('start-btn');
    const finishOverlay = document.getElementById('finish-overlay');
    const finalScoreEl = document.getElementById('final-score');
    const correctSound = document.getElementById('correct-sound');

    // éµç›¤è¼¸å…¥é‚è¼¯
    window.pressKey = function(val) {
        if (!timerInterval) return; // æ²’é–‹å§‹ä¸èƒ½æŒ‰
        if (val === 'back') {
            inputEl.value = inputEl.value.slice(0, -1);
        } else {
            inputEl.value += val;
        }
        checkAnswer();
    };

    function checkAnswer() {
        if (parseInt(inputEl.value) === currentAns) {
            correctSound.currentTime = 0;
            correctSound.play();
            score += 10;
            scoreEl.textContent = score;
            inputEl.value = '';
            nextQuestion();
        }
    }

    window.startGame = function() {
        score = 0;
        timeLeft = 30;
        scoreEl.textContent = score;
        timerEl.textContent = timeLeft;
        inputEl.value = '';
        startBtn.style.display = 'none';
        nextQuestion();
        
        timerInterval = setInterval(() => {
            timeLeft--;
            timerEl.textContent = timeLeft;
            if (timeLeft <= 0) endGame();
        }, 1000);
    };

    function nextQuestion() {
        const a = Math.floor(Math.random() * 9) + 1;
        const b = Math.floor(Math.random() * 9) + 1;
        currentAns = a * b;
        questionEl.textContent = `${a} Ã— ${b} = ?`;
    }

    function endGame() {
        clearInterval(timerInterval);
        timerInterval = null;
        finalScoreEl.textContent = score;
        finishOverlay.style.display = 'flex';
        
        const playerName = prompt("ä½ è¶…æ£’çš„ï¼è«‹è¼¸å…¥ä½ çš„åå­—ï¼š", "å°å¯¶è²");
        if (playerName) {
            push(scoreRef, { name: playerName, score: score, timestamp: Date.now() });
        }
    }

    window.closeOverlay = function() {
        finishOverlay.style.display = 'none';
        startBtn.style.display = 'inline-block';
        questionEl.textContent = "å†ä¾†æŒ‘æˆ°ä¸€å ´å§ï¼";
    };

    // æ’è¡Œæ¦œæ›´æ–°
    onValue(query(scoreRef, orderByChild('score'), limitToLast(15)), (snapshot) => {
        const data = snapshot.val();
        const rankBody = document.getElementById('rank-body');
        rankBody.innerHTML = '';
        let list = [];
        for (let id in data) list.push(data[id]);
        list.sort((a, b) => b.score - a.score).forEach((item, i) => {
            rankBody.innerHTML += `<tr><td>${i+1}</td><td>${item.name}</td><td>${item.score}</td></tr>`;
        });
    });
</script>

</body>
</html>


